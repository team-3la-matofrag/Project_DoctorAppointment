@using Project.MVC.Models
@using System.Text.Json

@{
    var userJson = Context.Session.GetString("CurrentUser");
    UserSession? user = null;
    if (!string.IsNullOrEmpty(userJson))
    {
        user = JsonSerializer.Deserialize<UserSession>(userJson);
    }
}

<div class="d-flex align-items-center gap-2">
    @if (user == null)
    {
        <a asp-controller="Account" asp-action="Login" class="btn btn-link text-dark fw-600 text-decoration-none">Sign In</a>
        <a asp-controller="Account" asp-action="Register" class="btn btn-primary rounded-pill px-4 shadow-sm">Get Started</a>
    }
    else
    {
        <div class="dropdown">
            <button class="btn btn-white border shadow-sm rounded-pill d-flex align-items-center gap-2 px-3 py-2" type="button" data-bs-toggle="dropdown">
                <div class="bg-primary-soft rounded-circle p-1">
                    <i class="bi bi-person-fill text-primary"></i>
                </div>
                <span class="fw-600 small">@user.FullName</span>
                <i class="bi bi-chevron-down small text-muted"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg rounded-4 p-2 mt-2 animate__animated animate__fadeIn">
                <li class="px-1 py-1 pb-2 border-bottom mb-2">
                    <span class="badge bg-light text-primary border rounded text-center w-100">@user.Role</span>
                </li>

                @if (user.Role == "Admin")
                {
                    <li><a class="dropdown-item rounded-3 py-2" asp-controller="Admin" asp-action="Dashboard"><i class="bi bi-grid-1x2 me-2"></i>Dashboard</a></li>
                }
                @if (user.Role == "Doctor")
                {
                    <li><a class="dropdown-item rounded-3 py-2" asp-controller="Doctors" asp-action="MyAppointments"><i class="bi bi-calendar-check me-2"></i>My Shifts</a></li>
                }
                @if (user.Role == "Patient")
                {
                    <li><a class="dropdown-item rounded-3 py-2" asp-controller="Patient" asp-action="Profile"><i class="bi bi-person me-2"></i>Profile</a></li>
                    <li><a class="dropdown-item rounded-3 py-2" asp-controller="Patient" asp-action="Dashboard"><i class="bi bi-grid-1x2 me-2"></i>Dashboard</a></li>
                    <li><a class="dropdown-item rounded-3 py-2" asp-controller="Patient" asp-action="Appointments"><i class="bi bi-clock-history me-2"></i>My Bookings</a></li>
                }

                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item rounded-3 py-2 text-danger" asp-controller="Account" asp-action="Logout"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
            </ul>
        </div>
    }
</div>